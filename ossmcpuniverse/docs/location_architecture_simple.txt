╔═══════════════════════════════════════════════════════════════════════════════╗
║          LOCATION NAVIGATION ReAct MULTI-AGENT ARCHITECTURE                   ║
╚═══════════════════════════════════════════════════════════════════════════════╝

                                USER QUERY
                                    │
                                    ▼
┌───────────────────────────────────────────────────────────────────────────────┐
│                   ORCHESTRATOR LAYER (gemma3:27b)                             │
│                                                                               │
│  ┌─────────────────────────────────────────────────────────────────────┐    │
│  │         LocationNavigationReAct - ReAct Loop (Max 10 iter)          │    │
│  │                                                                      │    │
│  │  Step 1: THOUGHT  → Reason about what data is needed next           │    │
│  │  Step 2: ACTION   → Select action type + parameters                 │    │
│  │  Step 3: OBSERVATION → Process worker results                       │    │
│  │  Step 4: UPDATE   → Store data in state manager                     │
│  │  Step 5: REPEAT   → Until answer action triggered                   │    │
│  │                                                                      │    │
│  │  State: {origin, destination, routes, rest_stops, viewpoints, elevations}│
│  └─────────────────────────────────────────────────────────────────────┘    │
│                                                                               │
│      ACTION TYPES: plan_routes | search_places | get_elevations | answer     │
└───────────────────────────────────────────────────────────────────────────────┘
        │                  │                    │                  │
        │ plan_routes      │ search_places      │ get_elevations   │ answer
        ▼                  ▼                    ▼                  ▼
┌──────────────────┐ ┌──────────────────┐ ┌─────────────────┐ ┌──────────────────┐
│ RoutePlanning    │ │ PlaceSearch      │ │ Elevation       │ │ DataSynthesis    │
│ Agent            │ │ Agent            │ │ Agent           │ │ Agent            │
│ (gemma3:4b)      │ │ (gemma3:4b)      │ │ (gemma3:4b)     │ │ (gemma3:4b)      │
├──────────────────┤ ├──────────────────┤ ├─────────────────┤ ├──────────────────┤
│                  │ │                  │ │                 │ │                  │
│ • Use LLM to     │ │ • Query Google   │ │ • Geocode       │ │ • Assemble all   │
│   suggest        │ │   Maps for rest  │ │   addresses     │ │   collected data │
│   intermediate   │ │   stops, scenic  │ │ • Query         │ │ • Convert to     │
│   cities         │ │   viewpoints     │ │   elevation API │ │   RestStop and   │
│ • Generate       │ │ • Filter by      │ │ • Return meters │ │   ScenicViewpoint│
│   creative route │ │   rating (≥4.0)  │ │   as string     │ │ • Build JSON     │
│   names          │ │ • Convert to     │ │                 │ │   matching       │
│ • Return route   │ │   PlaceInfo      │ │                 │ │   benchmark      │
│   details        │ │   objects        │ │                 │ │   format         │
│                  │ │                  │ │                 │ │                  │
└────────┬─────────┘ └─────────┬────────┘ └────────┬────────┘ └─────────┬────────┘
         │                     │                    │                    │
         └─────────────────────┴────────────────────┴────────────────────┘
                                        │
                                        ▼
                    ┌───────────────────────────────────────┐
                    │        MCP TOOL WRAPPER               │
                    │                                       │
                    │  • google_maps_search_places()        │
                    │  • google_maps_geocode()              │
                    │  • google_maps_elevation()            │
                    │  • google_maps_distance_matrix()      │
                    │  • google_maps_place_details()        │
                    │  • google_maps_reverse_geocode()      │
                    │                                       │
                    │  Handles: JSON parsing, error cases   │
                    └───────────────────┬───────────────────┘
                                        │
                                        ▼
                    ┌───────────────────────────────────────┐
                    │    GOOGLE MAPS MCP SERVER             │
                    │                                       │
                    │  • External Node.js process (stdio)   │
                    │  • 7 tools via MCP protocol           │
                    │  • Requires GOOGLE_MAPS_API_KEY       │
                    │  • Connects to Google Maps API        │
                    └───────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                            DATA FLOW EXAMPLE
═══════════════════════════════════════════════════════════════════════════════

User: "Plan 3 routes from Johor Bahru to Kuala Lumpur with 4 cities, 2 stops"

  [Iteration 1] → THOUGHT: Need to plan routes
                → ACTION: plan_routes("Johor Bahru", "Kuala Lumpur", 3, 4)
                → OBSERVATION: "Planned 3 routes with 4 cities each"
                → STATE: routes = [{route_id:1, ...}, {route_id:2, ...}, ...]

  [Iteration 2] → THOUGHT: Need to find rest stops
                → ACTION: search_places([12 cities], "rest_stop", count=2)
                → OBSERVATION: "Found 0 rest stops"
                → STATE: rest_stops = {}

  [Iteration 3] → THOUGHT: Need to find viewpoints
                → ACTION: search_places([12 cities], "scenic_viewpoint", count=2)
                → OBSERVATION: "Found 0 viewpoints"
                → STATE: viewpoints = {}

  [Iteration 4] → THOUGHT: Get elevation data
                → ACTION: get_elevations([])
                → OBSERVATION: "Retrieved elevations for 0 viewpoints"
                → STATE: elevations = {}

  [Iteration 5] → THOUGHT: All data collected, provide final answer
                → ACTION: answer (triggers synthesis)
                → SYNTHESIS: Assemble JSON with 3 routes, empty arrays
                → OUTPUT: {starting_city, destination_city, routes: [...]}


═══════════════════════════════════════════════════════════════════════════════
                          OUTPUT DATA STRUCTURE
═══════════════════════════════════════════════════════════════════════════════

LocationNavigationOutput (Pydantic)
│
├── starting_city: str
├── destination_city: str
└── routes: List[RouteDetails]
         │
         ├── route_id: str
         ├── route_name: str
         ├── cities_visited: List[str]
         │
         ├── rest_stops: List[RestStop]
         │         │
         │         ├── city: str
         │         ├── rest_stop_id: str
         │         ├── name: str
         │         ├── address: str
         │         └── amenities: List[str]
         │
         └── scenic_viewpoints: List[ScenicViewpoint]
                   │
                   ├── city: str
                   ├── viewpoint_id: str
                   ├── name: str
                   ├── address: str
                   ├── elevation_meters: str
                   └── description: str


═══════════════════════════════════════════════════════════════════════════════
                        KEY DESIGN PRINCIPLES
═══════════════════════════════════════════════════════════════════════════════

1. ORCHESTRATOR-WORKER PATTERN
   • Large model (27b) for complex reasoning and decision-making
   • Small models (4b) for specialized execution tasks
   • Reduces token usage by ~70% vs using 27b everywhere

2. ReAct THOUGHT-ACTION-OBSERVATION LOOP
   • Explicit reasoning at each step (transparency)
   • Iterative refinement with error recovery
   • Can adapt strategy based on observations

3. STATE ACCUMULATION
   • Collect data incrementally across iterations
   • Track associations (which places belong to which route)
   • Enable synthesis when all data ready

4. MCP ABSTRACTION
   • Decouple agent logic from API details
   • Standardized tool interface via MCP protocol
   • Easy to test and swap providers

5. GRACEFUL DEGRADATION
   • Handle missing data with empty arrays (not errors)
   • Retry failed searches before giving up
   • Return partial results if max iterations reached


═══════════════════════════════════════════════════════════════════════════════
                        PERFORMANCE METRICS
═══════════════════════════════════════════════════════════════════════════════

Simple Task (1 route, 2 cities):
  • Iterations: 5-7
  • Time: ~30-45 seconds
  • Google Maps calls: ~5-10
  • Tokens: ~15k

Complex Task (3 routes, 4 cities):
  • Iterations: 6-10
  • Time: ~60-90 seconds
  • Google Maps calls: ~20-40
  • Tokens: ~30-40k

Models Used:
  • Orchestrator: gemma3:27b (2.7B params)
  • Workers: gemma3:4b (4B params)
  • Total: 6.7B params active at any time


═══════════════════════════════════════════════════════════════════════════════
                        FILE LOCATIONS
═══════════════════════════════════════════════════════════════════════════════

Core Implementation:
  ossmcpuniverse/agents/location_navigation_react.py    (370 lines)
  ossmcpuniverse/agents/route_planning_agent.py         (200 lines)
  ossmcpuniverse/agents/place_search_agent.py           (116 lines)
  ossmcpuniverse/agents/elevation_agent.py              (100 lines)
  ossmcpuniverse/agents/data_synthesis_agent.py         (118 lines)

Supporting Code:
  ossmcpuniverse/agents/models.py                       (+80 lines)
  ossmcpuniverse/agents/tools.py                        (+190 lines)
  ossmcpuniverse/agents/__init__.py                     (updated exports)

Testing:
  ossmcpuniverse/scripts/test_location_react.py         (134 lines)
  ossmcpuniverse/scripts/run_benchmark.py               (existing)

Documentation:
  ossmcpuniverse/docs/location_navigation_architecture.md (this file!)


═══════════════════════════════════════════════════════════════════════════════
            Created by: Claude Code | Date: 2025-12-01
═══════════════════════════════════════════════════════════════════════════════
